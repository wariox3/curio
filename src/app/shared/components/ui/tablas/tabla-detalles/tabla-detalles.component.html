<div [class]="clasesContenedor">
  <!-- Mensaje cuando no hay datos -->
  <div *ngIf="!hayDatos" class="p-6 text-center text-gray-500">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-12 w-12 mx-auto mb-2 text-gray-300"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="1"
        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
      />
    </svg>
    <p>{{ textoVacio }}</p>
  </div>

  <!-- Tabla de detalles -->
  <table *ngIf="hayDatos" class="w-full text-sm">
    <tbody>
      <!-- Renderizado usando la nueva lógica organizada -->
      <ng-container *ngFor="let item of camposOrganizados">
        <!-- Campos que ocupan fila completa -->
        <tr *ngIf="item.tipo === 'filaCompleta'" class="border-b border-gray-200">
          <td [class]="clasesEtiqueta" [style.width]="item.campo!.anchoEtiqueta">
            {{ item.campo!.etiqueta }}
          </td>
          <td
            [attr.colspan]="columnas === 2 ? 1 : columnas === 4 ? 3 : columnas === 6 ? 5 : 7"
            class="px-4 py-3 text-gray-800"
            [style.width]="item.campo!.anchoValor"
          >
            {{ obtenerValor(item.campo!) }}
          </td>
        </tr>

        <!-- Grupos de campos normales -->
        <tr *ngIf="item.tipo === 'grupo'" class="border-b border-gray-200">
          <!-- Campos individuales (2 columnas) -->
          <ng-container *ngIf="columnas === 2">
            <td [class]="clasesEtiqueta" [style.width]="item.grupo![0].anchoEtiqueta || 'w-1/3'">
              {{ item.grupo![0].etiqueta }}
            </td>
            <td
              class="px-4 py-3 text-gray-800"
              [style.width]="item.grupo![0].anchoValor || 'w-2/3'"
            >
              {{ obtenerValor(item.grupo![0]) }}
            </td>
          </ng-container>

          <!-- Campos en pares, tríos o cuartetos (4, 6, 8 columnas) -->
          <ng-container *ngIf="columnas === 4 || columnas === 6 || columnas === 8">
            <!-- Primer campo (siempre existe) -->
            <td
              [class]="clasesEtiqueta"
              [style.width]="
                item.grupo![0].anchoEtiqueta ||
                (columnas === 4 ? 'w-1/4' : columnas === 6 ? 'w-1/6' : 'w-1/8')
              "
            >
              {{ item.grupo![0].etiqueta }}
            </td>
            <td
              class="px-4 py-3 text-gray-800 border-r border-gray-200"
              [style.width]="
                item.grupo![0].anchoValor ||
                (columnas === 4 ? 'w-1/4' : columnas === 6 ? 'w-1/6' : 'w-1/8')
              "
            >
              {{ obtenerValor(item.grupo![0]) }}
            </td>

            <!-- Segundo campo (si existe) -->
            <ng-container *ngIf="item.grupo!.length > 1">
              <td
                [class]="clasesEtiqueta"
                [style.width]="
                  item.grupo![1].anchoEtiqueta ||
                  (columnas === 4 ? 'w-1/4' : columnas === 6 ? 'w-1/6' : 'w-1/8')
                "
              >
                {{ item.grupo![1].etiqueta }}
              </td>
              <td
                class="px-4 py-3 text-gray-800"
                [ngClass]="{ 'border-r border-gray-200': columnas === 6 || columnas === 8 }"
                [style.width]="
                  item.grupo![1].anchoValor ||
                  (columnas === 4 ? 'w-1/4' : columnas === 6 ? 'w-1/6' : 'w-1/8')
                "
              >
                {{ obtenerValor(item.grupo![1]) }}
              </td>
            </ng-container>

            <!-- Tercer campo (para 6 y 8 columnas, si existe) -->
            <ng-container *ngIf="(columnas === 6 || columnas === 8) && item.grupo!.length > 2">
              <td
                [class]="clasesEtiqueta"
                [style.width]="item.grupo![2].anchoEtiqueta || (columnas === 6 ? 'w-1/6' : 'w-1/8')"
              >
                {{ item.grupo![2].etiqueta }}
              </td>
              <td
                class="px-4 py-3 text-gray-800"
                [ngClass]="{ 'border-r border-gray-200': columnas === 8 }"
                [style.width]="item.grupo![2].anchoValor || (columnas === 6 ? 'w-1/6' : 'w-1/8')"
              >
                {{ obtenerValor(item.grupo![2]) }}
              </td>
            </ng-container>

            <!-- Cuarto campo (solo para 8 columnas, si existe) -->
            <ng-container *ngIf="columnas === 8 && item.grupo!.length > 3">
              <td [class]="clasesEtiqueta" [style.width]="item.grupo![3].anchoEtiqueta || 'w-1/8'">
                {{ item.grupo![3].etiqueta }}
              </td>
              <td
                class="px-4 py-3 text-gray-800"
                [style.width]="item.grupo![3].anchoValor || 'w-1/8'"
              >
                {{ obtenerValor(item.grupo![3]) }}
              </td>
            </ng-container>

            <!-- Celdas vacías si faltan campos -->

            <!-- Para 4 columnas: si falta el segundo campo -->
            <ng-container *ngIf="columnas === 4 && item.grupo!.length < 2">
              <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
              <td class="px-4 py-3 text-gray-800 opacity-0">-</td>
            </ng-container>

            <!-- Para 6 columnas: celdas vacías según campos faltantes -->
            <ng-container *ngIf="columnas === 6">
              <!-- Si falta el segundo campo -->
              <ng-container *ngIf="item.grupo!.length < 2">
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 border-r border-gray-200 opacity-0">-</td>
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 opacity-0">-</td>
              </ng-container>
              <!-- Si hay segundo campo pero falta el tercero -->
              <ng-container *ngIf="item.grupo!.length === 2">
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 opacity-0">-</td>
              </ng-container>
            </ng-container>

            <!-- Para 8 columnas: celdas vacías según campos faltantes -->
            <ng-container *ngIf="columnas === 8">
              <!-- Si falta el segundo campo -->
              <ng-container *ngIf="item.grupo!.length < 2">
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 border-r border-gray-200 opacity-0">-</td>
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 border-r border-gray-200 opacity-0">-</td>
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 opacity-0">-</td>
              </ng-container>
              <!-- Si hay segundo campo pero falta el tercero -->
              <ng-container *ngIf="item.grupo!.length === 2">
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 border-r border-gray-200 opacity-0">-</td>
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 opacity-0">-</td>
              </ng-container>
              <!-- Si hay segundo y tercer campo pero falta el cuarto -->
              <ng-container *ngIf="item.grupo!.length === 3">
                <td [class]="clasesEtiqueta + ' opacity-0'">-</td>
                <td class="px-4 py-3 text-gray-800 opacity-0">-</td>
              </ng-container>
            </ng-container>
          </ng-container>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>
